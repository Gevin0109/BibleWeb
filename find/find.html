<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>查經頁面（套用 BibleBooksData.json + CORS Proxy）</title>
<style>
  :root{
    --bg:#0b1f3a;
    --yellow:#ffe93a;
    --btn:#35d56b;
    --btn2:#1bbd52;
    --danger:#a30000;
    --card:rgba(255,255,255,.10);
    --stroke:rgba(255,255,255,.16);
    --shadow:0 18px 40px rgba(0,0,0,.25);

    --popBg:#0a2346;
    --popBg2:#0b1f3a;
    --popItem:rgba(255,255,255,.10);
    --popItemHover:rgba(255,255,255,.16);
    --popStroke:rgba(255,255,255,.18);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Noto Sans TC",system-ui,-apple-system,"Segoe UI","Microsoft JhengHei",sans-serif;
    background:var(--bg);
    color:#fff;
    text-align:center;
    padding:18px 14px 26px;
  }
  h1{margin:0 0 10px;font-size:26px}

  .panel{
    max-width:980px;
    margin:0 auto;
    background:var(--card);
    border:2px solid var(--stroke);
    border-radius:16px;
    box-shadow:var(--shadow);
    padding:12px 12px 14px;
  }
  .controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    justify-content:center;
    padding:10px 6px 6px;
  }
  .controls .grp{
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
    justify-content:center;
  }

  select,input{
    padding:10px 10px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.12);
    color:#fff;
    outline:none;
    font-weight:800;
  }
  option{ background:#0b1f3a; color:#fff; }
  input{width:86px;text-align:center}

  button{
    padding:11px 14px;
    border:none;
    border-radius:14px;
    background:linear-gradient(180deg,var(--btn),var(--btn2));
    color:#fff;
    font-weight:1000;
    cursor:pointer;
    box-shadow:var(--shadow);
  }
  button:disabled{background:#8a8a8a;cursor:not-allowed;box-shadow:none}

  .meta{
    margin:10px 0 0;
    font-weight:900;
    color:rgba(255,255,255,.86);
    line-height:1.35;
  }
  .verseZh{
    margin:14px 0 10px;
    font-size:clamp(24px,3.2vw,40px);
    font-weight:1000;
    color:var(--yellow);
    line-height:1.35;
    white-space:pre-wrap;
  }
  .verseEn{
    margin:0 0 10px;
    font-size:clamp(18px,2.6vw,32px);
    font-weight:1000;
    color:var(--yellow);
    line-height:1.35;
    white-space:pre-wrap;
  }
  .error{
    display:none;
    margin:10px auto 0;
    max-width:980px;
    background:rgba(163,0,0,.78);
    border:2px solid rgba(255,255,255,.18);
    border-radius:14px;
    padding:10px 12px;
    font-weight:1000;
  }
  .barWrap{max-width:980px;margin:14px auto 0}
  .bar{
    height:28px;
    background:#fff;
    border-radius:14px;
    overflow:hidden;
    position:relative;
    border:2px solid rgba(0,0,0,.12);
  }
  .barFill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#3aa0ff,#00d7ff);
  }
  .barLabel{
    position:absolute; inset:0;
    display:grid; place-items:center;
    color:#0b1f3a;
    font-weight:1000;
  }
  .hint{
    margin-top:8px;
    font-size:13px;
    color:rgba(255,255,255,.72);
    line-height:1.45;
  }
  .sep{opacity:.6}

  /* ===== 自訂「書卷」下拉 ===== */
  .bookWrap{ position:relative; display:inline-block; }
  .bookBtn{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.12);
    color:#fff;
    font-weight:900;
    cursor:pointer;
    min-width:min(380px, 82vw);
    justify-content:space-between;
    box-shadow:none;
  }
  .bookBtn:active{ transform:translateY(1px); }
  .bookBtn .label{
    text-align:left;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
    max-width:calc(100% - 40px);
  }
  .chev{
    width:0;height:0;
    border-left:7px solid transparent;
    border-right:7px solid transparent;
    border-top:9px solid rgba(255,255,255,.86);
    opacity:.9;
    flex:0 0 auto;
  }

  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.35);
    display:none;
    z-index:999;
  }
  .overlay.show{ display:block; }
  .bookPop{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:min(560px, 92vw);
    max-height:min(72vh, 640px);
    background:linear-gradient(180deg,var(--popBg),var(--popBg2));
    border:2px solid var(--popStroke);
    border-radius:16px;
    box-shadow:0 24px 60px rgba(0,0,0,.45);
    overflow:hidden;
  }
  .bookPopHeader{
    padding:12px 12px 10px;
    display:flex;
    gap:10px;
    align-items:center;
    border-bottom:1px solid rgba(255,255,255,.14);
  }
  .bookPopHeader .title{ font-weight:1000; letter-spacing:.5px; }
  .bookPopHeader .close{
    margin-left:auto;
    padding:8px 10px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.10);
    color:#fff;
    font-weight:1000;
    cursor:pointer;
  }
  .bookSearch{
    width:100%;
    padding:10px 10px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,.16);
    background:rgba(255,255,255,.10);
    color:#fff;
    outline:none;
    font-weight:900;
  }
  .bookList{
    padding:10px;
    overflow:auto;
    max-height:calc(min(72vh, 640px) - 110px);
    -webkit-overflow-scrolling:touch;
  }
  .bookItem{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:12px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.10);
    color:#fff;
    font-weight:900;
    cursor:pointer;
    text-align:left;
    margin-bottom:10px;
  }
  .bookItem:hover{ background:rgba(255,255,255,.16); }
  .bookItem .names{
    display:flex;
    flex-direction:column;
    gap:2px;
    overflow:hidden;
  }
  .bookItem .names .zh{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .bookItem .names .en{
    font-size:12px;
    color:rgba(255,255,255,.74);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .badge{
    flex:0 0 auto;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.9);
  }

  /* ✅ 手機：章/節 用 select；桌機：章/節 用 input（同一格只會出現一個） */
  .chInput,.vInput{ display:inline-block; }
  .chSelect,.vSelect{ display:none; }

  @media (max-width:640px){
    .chInput,.vInput{ display:none; }
    .chSelect,.vSelect{ display:inline-block; }
  }

  @media (max-width:520px){
    .bookBtn{ min-width:min(320px, 88vw); }
    .controls{ gap:8px; }
  }
</style>
</head>
<body>

<h1>查經頁面</h1>

<div class="panel">
  <div class="controls">
    <div class="grp">
      <span>語言</span>
      <select id="lang">
        <option value="both">中英（cut + niv）</option>
        <option value="cut">只中文（cut）</option>
        <option value="niv">只英文（niv）</option>
      </select>
    </div>

    <div class="grp">
      <span>約</span>
      <select id="testament">
        <option value="OT">舊約 Old</option>
        <option value="NT" selected>新約 New</option>
      </select>
    </div>

    <div class="grp">
      <span>書卷</span>
      <div class="bookWrap">
        <button id="bookBtn" class="bookBtn" type="button" aria-haspopup="dialog" aria-expanded="false">
          <span class="label" id="bookBtnLabel">（載入中…）</span>
          <span class="chev" aria-hidden="true"></span>
        </button>
        <input id="book" type="hidden" value="">
      </div>
    </div>

    <!-- 章（只一組） -->
    <div class="grp">
      <span>章</span>
      <input id="chapter" class="chInput" type="number" value="1" min="1" step="1">
      <select id="chapterSel" class="chSelect"></select>
      <span class="sep">/</span>
      <span id="maxCh">—</span>
    </div>

    <!-- ✅ 節（只一組）：手機用 select，固定 1~180 -->
    <div class="grp">
      <span>節</span>
      <input id="verse" class="vInput" type="number" value="1" min="1" step="1">
      <select id="verseSel" class="vSelect"></select>
    </div>

    <div class="grp">
      <button id="btnSearch">搜尋</button>
      <button id="favBtn">加入收藏</button>
    </div>
  </div>

  <div class="meta" id="metaLine">（正在載入書卷資料…）</div>

  <div class="verseZh" id="zh"></div>
  <div class="verseEn" id="en"></div>
</div>

<div class="error" id="error"></div>

<div class="barWrap">
  <div class="bar">
    <div class="barFill" id="barFill"></div>
    <div class="barLabel" id="barLabel">0%</div>
  </div>
  <div class="hint">
    閱讀率：以「目前書卷 Verses（總節數）」為分母；閱讀紀錄只在中文 cut 成功取得時才會記錄。
  </div>
</div>

<!-- 書卷彈窗 -->
<div class="overlay" id="overlay" aria-hidden="true">
  <div class="bookPop" role="dialog" aria-modal="true" aria-label="選擇書卷">
    <div class="bookPopHeader">
      <div class="title">選擇書卷</div>
      <button class="close" id="bookClose" type="button">關閉</button>
    </div>
    <div style="padding:10px 12px 0;">
      <input id="bookSearch" class="bookSearch" placeholder="搜尋：中文 / English / Code（例如 mat, gal）" autocomplete="off">
    </div>
    <div class="bookList" id="bookList"></div>
  </div>
</div>

<script>
const BOOKS_URL = "assets/BibleBooksData.json";
const LS_FAV  = "bible_fav_v1";
const LS_READ = "bible_read_cut_v1";

/* ✅ 手機「節」固定可選 1~180 */
const VERSE_SELECT_MAX = 180;

const elLang = document.getElementById("lang");
const elTest = document.getElementById("testament");

const elBook = document.getElementById("book");
const bookBtn = document.getElementById("bookBtn");
const bookBtnLabel = document.getElementById("bookBtnLabel");

const elCh    = document.getElementById("chapter");     // input
const elChSel = document.getElementById("chapterSel");  // select
const elMaxCh = document.getElementById("maxCh");

const elV     = document.getElementById("verse");       // input
const elVSel  = document.getElementById("verseSel");    // select

const elZh   = document.getElementById("zh");
const elEn   = document.getElementById("en");
const elErr  = document.getElementById("error");
const elMeta = document.getElementById("metaLine");

const btnSearch = document.getElementById("btnSearch");
const btnFav    = document.getElementById("favBtn");

const barFill  = document.getElementById("barFill");
const barLabel = document.getElementById("barLabel");

const overlay = document.getElementById("overlay");
const bookListEl = document.getElementById("bookList");
const bookSearchEl = document.getElementById("bookSearch");
const bookCloseBtn = document.getElementById("bookClose");

let BOOKS_ALL = [];
let BOOKS_BY_TEST = { OT: [], NT: [] };

function lsGet(key, fallback){
  try{
    const v = localStorage.getItem(key);
    return v ? JSON.parse(v) : fallback;
  }catch(e){ return fallback; }
}
function lsSet(key, value){
  localStorage.setItem(key, JSON.stringify(value));
}
function inferTestamentById(id){
  const n = Number(id);
  if(!Number.isFinite(n)) return "OT";
  return (n <= 39) ? "OT" : "NT";
}

async function loadBooks(){
  const res = await fetch(BOOKS_URL, { cache:"no-store" });
  if(!res.ok) throw new Error("讀不到 BibleBooksData.json（路徑或伺服器設定）");

  const raw = await res.json();
  if(!Array.isArray(raw)) throw new Error("BibleBooksData.json 必須是 Array");

  BOOKS_ALL = raw.map(b => ({
    Id: b.Id,
    Code: String(b.Code || "").trim().toLowerCase(),
    Name: b.Name || "",
    NameE: b.NameE || "",
    Chapters: Number(b.Chapters || 0),
    Verses: Number(b.Verses || 0),
    Testament: inferTestamentById(b.Id),
  })).filter(b => b.Code);

  BOOKS_BY_TEST.OT = BOOKS_ALL.filter(b => b.Testament === "OT");
  BOOKS_BY_TEST.NT = BOOKS_ALL.filter(b => b.Testament === "NT");

  elTest.value = BOOKS_BY_TEST.NT.length ? "NT" : "OT";

  const first = (BOOKS_BY_TEST[elTest.value] || [])[0];
  elBook.value = first ? first.Code : (BOOKS_ALL[0]?.Code || "");

  // 預設 1章1節
  elCh.value = 1;
  elV.value = 1;

  buildVerseSelectOnce();
  syncVerseToSelect();

  updateBookButtonLabel();
  updateMetaAndLimits();
  updateFavButton();
  updateReadRate();
  rebuildBookPopupList();
}

function getSelectedBook(){
  const code = (elBook.value || "").toLowerCase();
  return BOOKS_ALL.find(b => b.Code === code) || null;
}
function updateBookButtonLabel(){
  const b = getSelectedBook();
  bookBtnLabel.textContent = b ? `${b.Name} / ${b.NameE}` : (elBook.value || "（無資料）");
}

/* ===== 章（手機 select） ===== */
function rebuildChapterSelect(){
  const b = getSelectedBook();
  const max = Math.max(1, Number(b?.Chapters || 1));

  let cur = Number(elCh.value || 1);
  if(!Number.isFinite(cur) || cur < 1) cur = 1;
  if(cur > max) cur = max;

  if(elChSel.options.length !== max){
    elChSel.innerHTML = "";
    const frag = document.createDocumentFragment();
    for(let i=1;i<=max;i++){
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = String(i);
      frag.appendChild(opt);
    }
    elChSel.appendChild(frag);
  }

  elCh.value = cur;
  elChSel.value = String(cur);
  elCh.max = max;
  elMaxCh.textContent = String(max);
}

function clampChapter(){
  const b = getSelectedBook();
  const max = Math.max(1, Number(b?.Chapters || 1));
  let v = parseInt(elCh.value || "1", 10);
  if(!Number.isFinite(v) || v < 1) v = 1;
  if(v > max) v = max;
  elCh.value = v;
  elCh.max = max;
  elMaxCh.textContent = String(max);
  rebuildChapterSelect();
}

/* ===== ✅ 節（手機 select，固定 1~180） ===== */
function buildVerseSelectOnce(){
  if(elVSel.options.length === VERSE_SELECT_MAX) return;
  elVSel.innerHTML = "";
  const frag = document.createDocumentFragment();
  for(let i=1;i<=VERSE_SELECT_MAX;i++){
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = String(i);
    frag.appendChild(opt);
  }
  elVSel.appendChild(frag);
}

function clampVerse(){
  let v = parseInt(elV.value || "1", 10);
  if(!Number.isFinite(v) || v < 1) v = 1;
  if(v > VERSE_SELECT_MAX) v = VERSE_SELECT_MAX;
  elV.value = v;
  syncVerseToSelect();
}

function syncVerseToSelect(){
  buildVerseSelectOnce();
  let v = parseInt(elV.value || "1", 10);
  if(!Number.isFinite(v) || v < 1) v = 1;
  if(v > VERSE_SELECT_MAX) v = VERSE_SELECT_MAX;
  elVSel.value = String(v);
}

function updateMetaAndLimits(){
  const b = getSelectedBook();
  const code = b?.Code || elBook.value;
  const name = b?.Name || "";
  const nameE = b?.NameE || "";
  const verses = b?.Verses || 0;
  const chMax = Math.max(1, Number(b?.Chapters || 1));

  elMeta.textContent =
    `${name} ${nameE} ｜ Code: ${code} ｜ Chapters: ${chMax || "—"} ｜ Verses: ${verses || "—"}`;

  rebuildChapterSelect();
  clampVerse(); // 仍固定 1~180
}

function showError(msg){
  elErr.style.display = "block";
  elErr.textContent = msg;
}
function hideError(){
  elErr.style.display = "none";
  elErr.textContent = "";
}

function parseIbiblesFirstVerse(html){
  const re = /<small>([^<]+)<\/small>\s*([^<]+)<br>/;
  const m = html.match(re);
  return m ? (m[2] || "").trim() : null;
}
async function fetchVerseViaProxy(lang, bookCode, ch, v){
  const target = `https://ibibles.net/quote.php?${lang}-${bookCode}/${ch}:${v}`;
  const url = "https://api.allorigins.win/raw?url=" + encodeURIComponent(target);
  const res = await fetch(url, { cache:"no-store" });
  if(!res.ok) throw new Error("network");
  const html = await res.text();
  return parseIbiblesFirstVerse(html);
}

function verseKey(){
  const code = (elBook.value || "").toLowerCase();
  const ch = Math.max(1, parseInt(elCh.value || "1", 10));
  const v  = Math.max(1, parseInt(elV.value  || "1", 10));
  return `${code}/${ch}:${v}`;
}

/* 收藏 */
function getFavList(){ return lsGet(LS_FAV, []); }
function isFavorited(){
  const id = verseKey();
  return getFavList().some(x => x.id === id);
}
function updateFavButton(){
  const yes = isFavorited();
  btnFav.disabled = yes;
  btnFav.textContent = yes ? "已收藏" : "加入收藏";
}
btnFav.addEventListener("click", () => {
  if(btnFav.disabled) return;

  const b = getSelectedBook();
  const id = verseKey();
  const list = getFavList();

  list.unshift({
    id,
    code: (b?.Code || elBook.value || "").toLowerCase(),
    name: b?.Name || "",
    nameE: b?.NameE || "",
    ch: parseInt(elCh.value||"1",10),
    v: parseInt(elV.value||"1",10),
    zh: elZh.textContent || "",
    en: elEn.textContent || "",
    ts: Date.now()
  });

  lsSet(LS_FAV, list);
  updateFavButton();
  alert("已加入收藏（localStorage）");
});

/* 閱讀率 */
function getReadSet(){ return new Set(lsGet(LS_READ, [])); }
function saveReadSet(set){ lsSet(LS_READ, Array.from(set)); }
function markRead(){
  const set = getReadSet();
  set.add(verseKey());
  saveReadSet(set);
}
function updateReadRate(){
  const b = getSelectedBook();
  const code = (b?.Code || elBook.value || "").toLowerCase();
  const total = Number(b?.Verses || 0);

  const set = getReadSet();
  let count = 0;
  for(const k of set){
    if(k.startsWith(code + "/")) count++;
  }

  let pct = 0;
  if(total > 0){
    pct = Math.max(0, Math.min(100, Math.round((count / total) * 100)));
  }
  barFill.style.width = pct + "%";
  barLabel.textContent = pct + "%";
}

/* 搜尋 */
async function searchBible(){
  hideError();
  clampChapter();
  clampVerse();

  const b = getSelectedBook();
  const bookCode = (b?.Code || elBook.value || "").toLowerCase();

  const ch = Math.max(1, parseInt(elCh.value || "1", 10));
  const v  = Math.max(1, parseInt(elV.value  || "1", 10));

  elZh.textContent = "（載入中…）";
  elEn.textContent = "";

  const mode = elLang.value;

  try{
    let zh = "", en = "";

    if(mode === "both" || mode === "cut"){
      zh = await fetchVerseViaProxy("cut", bookCode, ch, v);
      if(!zh){
        elZh.textContent = "";
        elEn.textContent = "";
        showError("查無此章節！（或書卷 Code 不符合 ibibles 代碼）");
        return;
      }
      elZh.textContent = zh;
      markRead();
    }else{
      elZh.textContent = "";
    }

    if(mode === "both" || mode === "niv"){
      en = await fetchVerseViaProxy("niv", bookCode, ch, v);
      elEn.textContent = en || "";
    }

    updateFavButton();
    updateReadRate();
  }catch(e){
    elZh.textContent = "";
    elEn.textContent = "";
    showError("您的網路未連線 無法取得資料！（或 Proxy 暫時不可用）");
  }
}

/* ===== 書卷彈窗 ===== */
function currentBookList(){
  const t = elTest.value;
  return BOOKS_BY_TEST[t] || [];
}
function rebuildBookPopupList(filterText=""){
  const list = currentBookList();
  const q = (filterText || "").trim().toLowerCase();

  const filtered = !q ? list : list.filter(b => {
    const s = `${b.Name} ${b.NameE} ${b.Code}`.toLowerCase();
    return s.includes(q);
  });

  if(!filtered.length){
    bookListEl.innerHTML = `<div style="padding:14px;color:rgba(255,255,255,.75);font-weight:900;">找不到符合的書卷</div>`;
    return;
  }

  bookListEl.innerHTML = filtered.map(b => {
    const isNow = (b.Code === (elBook.value||"").toLowerCase());
    return `
      <div class="bookItem" data-code="${b.Code}">
        <div class="names">
          <div class="zh">${isNow ? "✅ " : ""}${escapeHtml(b.Name)}</div>
          <div class="en">${escapeHtml(b.NameE)} · Code: ${escapeHtml(b.Code)}</div>
        </div>
        <div class="badge">${b.Chapters || "—"} 章</div>
      </div>
    `;
  }).join("");
}
function openBookPopup(){
  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
  bookBtn.setAttribute("aria-expanded","true");
  bookSearchEl.value = "";
  rebuildBookPopupList("");
  bookSearchEl.focus({preventScroll:true});
}
function closeBookPopup(){
  overlay.classList.remove("show");
  overlay.setAttribute("aria-hidden","true");
  bookBtn.setAttribute("aria-expanded","false");
}
overlay.addEventListener("click", (e) => { if(e.target === overlay) closeBookPopup(); });
bookCloseBtn.addEventListener("click", closeBookPopup);
document.addEventListener("keydown", (e) => {
  if(e.key === "Escape" && overlay.classList.contains("show")) closeBookPopup();
});
bookBtn.addEventListener("click", openBookPopup);
bookSearchEl.addEventListener("input", () => rebuildBookPopupList(bookSearchEl.value));
bookListEl.addEventListener("click", (e) => {
  const item = e.target.closest(".bookItem");
  if(!item) return;
  const code = (item.getAttribute("data-code") || "").toLowerCase();
  if(!code) return;

  elBook.value = code;

  // 換書卷回到 1章1節
  elCh.value = 1;
  elV.value = 1;
  syncVerseToSelect();

  updateBookButtonLabel();
  updateMetaAndLimits();
  updateFavButton();
  updateReadRate();
  closeBookPopup();
});

function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* 事件：約切換 */
elTest.addEventListener("change", () => {
  const first = (BOOKS_BY_TEST[elTest.value] || [])[0];
  if(first) elBook.value = first.Code;

  elCh.value = 1;
  elV.value = 1;
  syncVerseToSelect();

  updateBookButtonLabel();
  updateMetaAndLimits();
  updateFavButton();
  updateReadRate();
  rebuildBookPopupList("");
});

/* 章：桌機 input 改變時，同步 select */
elCh.addEventListener("input", clampChapter);
elCh.addEventListener("change", clampChapter);
/* 章：手機 select 改變時，同步 input */
elChSel.addEventListener("change", () => {
  elCh.value = parseInt(elChSel.value || "1", 10) || 1;
  clampChapter();
});

/* ✅ 節：桌機 input 改變時，同步手機 select */
elV.addEventListener("input", clampVerse);
elV.addEventListener("change", clampVerse);
/* ✅ 節：手機 select 改變時，同步桌機 input */
elVSel.addEventListener("change", () => {
  elV.value = parseInt(elVSel.value || "1", 10) || 1;
  clampVerse();
});

btnSearch.addEventListener("click", searchBible);

/* 啟動 */
(async function boot(){
  try{
    await loadBooks();
    searchBible();
  }catch(e){
    showError(String(e?.message || e));
  }
})();
</script>

</body>
</html>
